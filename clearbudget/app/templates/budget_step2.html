{% extends 'base.html' %}

{% block content %}
<h2>Budget Wizard - Step 2: Add Students & Postdocs</h2>

<h3>Add New Student/Postdoc</h3>
<form method="post">
    <input type="hidden" name="add_student" value="1">
    <label>Name:</label>
    <input type="text" name="name" required><br>

    <label>Role:</label>
    <select name="role">
        <option value="Student">Student</option>
        <option value="Postdoc">Postdoc</option>
    </select><br>

    <label>Effort (FTE):</label>
    <input type="number" step="0.01" name="fte" required><br>

    <label>Annual Salary/Stipend ($):</label>
    <input type="number" step="0.01" name="salary" required><br>

    <label for="fringe">Fringe Rate (%):</label>
    <input type="number" name="fringe" id="fringe" step="0.01" required>
    
    <label for="residency">Residency:</label>
    <select name="residency" id="residency" required>
        <option value="In-State">In-State</option>
        <option value="Out-of-State">Out-of-State</option>
    </select>
    
    <label for="semester">Semester:</label>
    <select name="semester" id="semester" required>
        <option value="Fall">Fall</option>
        <option value="Spring">Spring</option>
        <option value="Summer">Summer</option>
    </select>

    <button type="submit">Add</button>
</form>

<h3>Current Personnel in Budget</h3>
<form method="post">
    <button type="submit" name="delete_all" onclick="return confirm('Delete all personnel?');">Delete All</button>
</form>

<table border="1" cellpadding="5">
    <tr>
        <th>Name</th>
        <th>Role</th>
        <th>FTE</th>
        <th>Salary</th>
        <th>Fringe</th>
        <th>Tuition</th>
        <th>Residency</th>
        <th>Semester</th>
        <th>Actions</th>
    
    </tr>

    {% for p in selected_personnel %}
    <tr>
        <form method="post">
            <input type="hidden" name="edit_id" value="{{ p.id }}">
            <td><input type="text" name="name" value="{{ p.name }}"></td>
            <td><input type="text" name="role" value="{{ p.role }}"></td>
            <td><input type="number" step="0.01" name="fte" value="{{ p.fte }}"></td>
            <td><input type="number" step="0.01" name="salary" value="{{ p.salary }}"></td>
            <td><input type="number" step="0.01" name="fringe" value="{{ p.fringe }}"></td>
            <td><input type="number" step="0.01" name="tuition" value="{{ "%.2f"|format(p.get('tuition',0)) if p.get('type')=='Student' else 0 }}"></td>
            <td><input type="text" name="residency" value="{{p.residency}}"></td>
            <td><input type="text" name="Semester" value="{{p.semester}}"></td>
            <td>
                <button type="submit" name="delete_id" value="{{ p.id }}" onclick="return confirm('Delete this personnel?');">Delete</button>
            </td>
        </form>
    </tr>
    {% endfor %}
</table>

<a href="{{ url_for('budget.step3') }}">Next: Review Budget</a>
{% endblock %}
